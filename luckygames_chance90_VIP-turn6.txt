var url = window.location.href;
var start_time = new Date();
var _coin           = "doge",
    _stop           = true,
    _currentBalance = parseFloat($("#balance").val()).toFixed(8),
    _profit         = 0,
    _totalBet       = 0,
    _betSpeed       = 0,
    count_turn1     = 0,
    count_turn2     = 0,
    count_turn3     = 0,
    count_turn4     = 0,
    count_turn5     = 0,
    count_turn6     = 0,
    _diviceNum      = 2222300,
    _baseBet        = (parseFloat($("#balance").val())/_diviceNum).toFixed(8),
    _betAmount      = _baseBet,
    _lastResult     = "",
    _lastStatus     = "false",
    turn            = 0,
    _prediction     = 11,
    _direction      = "over",
    _clientSeed     = "e2863526a6fec3ffe4bde6a1d0c5260e",
    _serverSeedHash = "",
    _hash           = url.substring(url.indexOf("=") + 1, url.length);
function changeSeed() {
    _clientSeed = "";
    var charset = "abcdef0123456789";
    var _array = new Uint32Array(32);
    window.crypto.getRandomValues(_array);
    for (var i = 0; i < 32; i++){
        _clientSeed += charset.charAt(_array[i]%10);
    }
}
function updatePara(responseText){
    var _result = JSON.parse(responseText);
    var _lastProfit = _result.profit;
    _serverSeedHash     = _result.serverHash;
    _currentBalance     = _result.balance;
    _lastResult         = _result.gameResult;
    _lastStatus         = _result.result;
    if(_lastStatus == "true" || _lastStatus == true)
        _profit         += parseFloat(_lastProfit);
}
function createStatisticElement(){
    var para = document.createElement("div");
    para.setAttribute("id", "dicebot");
    para.style.color = "green";
    document.body.appendChild(para);

    para = document.createElement("div");
    para.setAttribute("id", "title");
    para.appendChild(document.createTextNode("DICEBOT by Ngo Anh Duc"));
    para.style.color = "red";
    para.style.textAlign = "center";
    para.style.fontSize = "40px";
    var elemt = document.getElementById("dicebot");
    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(para);
    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(document.createElement("br"));

    var x = document.createElement("TABLE");
    x.style.textAlign = "center";
    x.setAttribute("vertical-align", "bottom");
    x.setAttribute("id", "myTable");
    x.setAttribute("width", "20%");
    x.setAttribute("height", "500px");
    x.setAttribute("align", "center");
    x.setAttribute("border-collapse", "collapse");
    x.style.fontSize = "20px";
    elemt.appendChild(x);

    var y = document.createElement("TR");
    y.setAttribute("id", "myTr1");
    document.getElementById("myTable").appendChild(y);

    var z = document.createElement("TD");
    z.appendChild(document.createTextNode("Last Result"));
    document.getElementById("myTr1").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "_lastResult");
    z.appendChild(document.createTextNode(_lastResult));
    document.getElementById("myTr1").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr2");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("Current Balace"));
    document.getElementById("myTr2").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "_currentBalance");
    z.appendChild(document.createTextNode(_currentBalance));
    document.getElementById("myTr2").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr3");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("Profit"));
    document.getElementById("myTr3").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "_profit");
    z.appendChild(document.createTextNode(_profit));
    document.getElementById("myTr3").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr4");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("Current Turn"));
    document.getElementById("myTr4").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "turn");
    z.appendChild(document.createTextNode(turn));
    document.getElementById("myTr4").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr5");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("count_turn1"));
    document.getElementById("myTr5").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "count_turn1");
    z.appendChild(document.createTextNode(count_turn1));
    document.getElementById("myTr5").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr6");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("count_turn2"));
    document.getElementById("myTr6").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "count_turn2");
    z.appendChild(document.createTextNode(count_turn2));
    document.getElementById("myTr6").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr7");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("count_turn3"));
    document.getElementById("myTr7").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "count_turn3");
    z.appendChild(document.createTextNode(count_turn3));
    document.getElementById("myTr7").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr8");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("count_turn4"));
    document.getElementById("myTr8").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "count_turn4");
    z.appendChild(document.createTextNode(count_turn4));
    document.getElementById("myTr8").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr9");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("count_turn5"));
    document.getElementById("myTr9").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "count_turn5");
    z.appendChild(document.createTextNode(count_turn5));
    document.getElementById("myTr9").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr10");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("count_turn6"));
    document.getElementById("myTr10").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "count_turn6");
    z.appendChild(document.createTextNode(count_turn6));
    document.getElementById("myTr10").appendChild(z);
    
    y = document.createElement("TR");
    y.setAttribute("id", "myTr11");
    document.getElementById("myTable").appendChild(y);
    z = document.createElement("TD");
    z.appendChild(document.createTextNode("bet speed"));
    document.getElementById("myTr11").appendChild(z);
    z = document.createElement("TD");
    z.setAttribute("id", "_betSpeed");
    z.appendChild(document.createTextNode(_betSpeed));
    document.getElementById("myTr11").appendChild(z);


    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(document.createElement("br"));
    elemt.appendChild(document.createElement("br"));

    var btn = document.createElement("BUTTON");
    btn.appendChild(document.createTextNode("START"));
    btn.setAttribute("id","startAuto");
    btn.setAttribute("onclick","_stop=false;sendBet();");
    btn.style.align = "center";
    document.body.appendChild(btn);
    

    btn = document.createElement("BUTTON")
    btn.appendChild(document.createTextNode("STOP"));
    btn.setAttribute("id","stopAuto");
    btn.setAttribute("onclick","_stop=true");
    document.body.appendChild(btn);
}
function statistic(){
    var current_time = new Date();
    var playing_time = current_time - start_time;
    var playing_hours = Math.floor((playing_time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); 
    var playing_mins = Math.floor((playing_time % (1000 * 60 * 60)) / (1000 * 60));
    var playing_secs = Math.floor((playing_time % (1000 * 60)) / 1000);
    _betSpeed = parseFloat((_totalBet/playing_time)*1000).toFixed(2);
    // console.clear();
    // console.log("Last Result        : " + _lastResult);
    // console.log("Current Balace     : " + _currentBalance);
    // console.log('Profit             : ' + _profit);
    // console.log("Turn               : " + turn);
    // console.log('count_turn1        : ' +count_turn1);
    // console.log('count_turn2        : ' +count_turn2);
    // console.log('count_turn3        : ' +count_turn3);
    // console.log('count_turn4        : ' +count_turn4);
    // console.log('count_turn5        : ' +count_turn5);
    // console.log('count_turn6        : ' +count_turn6);
    // console.log('bet speed          : ' + _betSpeed + ' (bets/s)');
    $("#_lastResult")[0].innerText= _lastResult;
    $("#_currentBalance")[0].innerText= _currentBalance;
    $("#_profit")[0].innerText= parseFloat(_profit).toFixed(8);
    $("#turn")[0].innerText= turn;
    $("#count_turn1")[0].innerText= count_turn1;
    $("#count_turn2")[0].innerText= count_turn2;
    $("#count_turn3")[0].innerText= count_turn3;
    $("#count_turn4")[0].innerText= count_turn4;
    $("#count_turn5")[0].innerText= count_turn5;
    $("#count_turn6")[0].innerText= count_turn6;
    $("#_betSpeed")[0].innerText= _betSpeed + " bet/s";
}
function sendBet(){
    changeSeed();
    if(_stop == false)
    $.ajax({
                type: "POST",
                url: "https://luckygames.io/ajx/",
                cache: false,
                data: {
                    game:               "dice",
                    coin:               _coin,
                    betAmount:          _betAmount,
                    prediction:         _prediction,
                    direction:          _direction,
                    clientSeed:         _clientSeed,
                    serverSeedHash:     _serverSeedHash,
                    action:             "playBet",
                    hash:               _hash,
                },
                success: function(text) {
                    updatePara(text);
                    if(_lastStatus == "false" || _lastStatus == false){
                        console.log("failed! Trying again....");
                        setTimeout(sendBet(), 1000);
                    }
                    else{
                        _totalBet++;
                        if(_lastResult.toLocaleLowerCase() === "win"){
                            if(_betAmount >= 9*_baseBet && _betAmount < 12*_baseBet)
                                count_turn1++;
                            if(_betAmount >= 190*_baseBet && _betAmount < 220*_baseBet)
                                count_turn2++;
                            if(_betAmount >= 1900*_baseBet && _betAmount <= 2200*_baseBet)
                                count_turn3++;
                            if(_betAmount >= 19000*_baseBet && _betAmount <= 22000*_baseBet)
                                count_turn4++;
                            if(_betAmount >= 190000*_baseBet && _betAmount <= 220000*_baseBet)
                                count_turn5++;
                            if(_betAmount >= 1900000*_baseBet && _betAmount <= 2200000*_baseBet)
                                count_turn6++;

                            if(turn == 0 && _betAmount >= 9*_baseBet || turn >= 1 && turn <=2 && _betAmount >= 190*_baseBet)
                                turn = 0;
                            if(turn == 3 && _betAmount >= 1900*_baseBet)
                                turn -= 2;
                            if(turn == 4 && _betAmount >= 19000*_baseBet)
                                turn -= 2;
                            if(turn == 5 && _betAmount >= 190000*_baseBet)
                                turn -=2;
                            if(turn == 0)
                                _baseBet = parseFloat(_currentBalance / _diviceNum).toFixed(8);
                            if(_baseBet < 0.0000001)
                                _baseBet = 0.0000001;
                            _betAmount = _baseBet;
                        }
                        if(_lastResult.toLocaleLowerCase() === "lose"){
                            if(_betAmount > 9* _baseBet && _betAmount < 11*_baseBet)
                                turn++;

                            if(turn==0 && _betAmount > 0.9 * _baseBet && _betAmount < 1.1*_baseBet){
                                _betAmount=10 * _baseBet;
                            }
                            else
                            if(turn == 1 && _betAmount > 9* _baseBet && _betAmount < 11*_baseBet){
                                _betAmount = 1*_baseBet;
                            }
                            else
                            if(turn == 1 && _betAmount > 0.9 * _baseBet && _betAmount < 1.1*_baseBet){
                                _betAmount=10*_baseBet;
                            }
                            else
                            if(turn == 2 && _betAmount > 9* _baseBet && _betAmount < 11*_baseBet){
                                _betAmount=200*_baseBet;
                            }
                            else

                            if(turn == 2 && _betAmount>190*_baseBet && _betAmount < 210*_baseBet){
                                _betAmount = 1*_baseBet;
                            }
                            else
                            if(turn == 2 && _betAmount > 0.9 * _baseBet && _betAmount < 1.1*_baseBet){
                                _betAmount=10*_baseBet;
                            }
                            else
                            if(turn == 3 && _betAmount > 9* _baseBet && _betAmount < 11*_baseBet){
                                _betAmount = 2000*_baseBet;
                            }
                            else
                            if(turn == 3 && _betAmount>1900*_baseBet && _betAmount < 2100*_baseBet)
                                _betAmount=1*_baseBet;
                            else
                            if(turn == 3 && _betAmount > 0.9 * _baseBet && _betAmount < 1.1*_baseBet)
                                _betAmount=10*_baseBet;
                            else
                            if(turn == 4 && _betAmount > 9* _baseBet && _betAmount < 11*_baseBet)
                                _betAmount=20000*_baseBet;
                            else
                            if(turn == 4 && _betAmount>19000*_baseBet && _betAmount < 21000*_baseBet)
                                _betAmount=1*_baseBet;
                            else
                            if(turn == 4 && _betAmount > 0.9 * _baseBet && _betAmount < 1.1*_baseBet)
                                _betAmount=10*_baseBet;
                            else
                            if(turn == 5 && _betAmount > 9* _baseBet && _betAmount < 11*_baseBet)
                                _betAmount=200000*_baseBet;
                            else
                            if(turn == 5 && _betAmount>19000*_baseBet && _betAmount < 21000*_baseBet)
                                _betAmount=1*_baseBet;
                            else
                            if(turn == 5 && _betAmount > 0.9 * _baseBet && _betAmount < 1.1*_baseBet)
                                _betAmount=10*_baseBet;
                            else
                            if(turn == 6 && _betAmount > 9* _baseBet && _betAmount < 11*_baseBet)
                                _betAmount=200000*_baseBet;
                            else
                            if(turn == 7 && _betAmount>190000*_baseBet && _betAmount < 210000*_baseBet)
                                _betAmount=_baseBet;
                        }
                        statistic();
                        sendBet();
                    }
                },
                error:function (xhr, ajaxOptions, thrownError) {
                    sendBet();
                },
                timeout:function (xhr, ajaxOptions, thrownError) {
                    sendBet();
                },
                abort:function (xhr, ajaxOptions, thrownError) {
                    sendBet();
                }
            });    
}
//sendBet();
$("#body").remove();
$("#sidebar").remove();
createStatisticElement();
